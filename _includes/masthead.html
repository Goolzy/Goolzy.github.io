{% comment %}
  Prefer explicit logo path if set; otherwise allow a wordmark-specific key.
{% endcomment %}
{% assign site_logo = site.logo_wordmark | default: site.logo | relative_url %}

<header id="masthead">
  <div class="inner">
    <div class="title-area">
      {% if page.url == '/' %}
        <h1 class="site-title">
          <a href="{{ '/' | relative_url }}">
            {% if site.logo or site.logo_wordmark %}
              <img src="{{ site_logo }}" alt="{{ site.title | escape }}" class="site-logo{% if site.logo_wordmark %} site-logo--wordmark{% endif %}" onerror="this.style.display='none'">
            {% endif %}
            {% unless site.logo_wordmark %}<span>{{ site.title | escape }}</span>{% endunless %}
          </a>
        </h1>
      {% else %}
        <p class="site-title">
          <a href="{{ '/' | relative_url }}">
            {% if site.logo or site.logo_wordmark %}
              <img src="{{ site_logo }}" alt="{{ site.title | escape }}" class="site-logo{% if site.logo_wordmark %} site-logo--wordmark{% endif %}" onerror="this.style.display='none'">
            {% endif %}
            {% unless site.logo_wordmark %}<span>{{ site.title | escape }}</span>{% endunless %}
          </a>
        </p>
      {% endif %}
    </div>
    <div class="masthead-account" aria-label="Account actions" style="margin-left:auto; display:flex; align-items:center; gap:.5rem;">
      <button id="mh-logout" class="btn" type="button" style="display:none; padding:.25rem .6rem; font-size:.9rem;">로그아웃</button>
    </div>
  </div>
</header>

<script>
(function(){
  function qs(id){ return document.getElementById(id); }
  function updateAuthUI(user){
    var logout = qs('mh-logout');
    if (!logout) return;
    if (user) {
      logout.style.display = '';
    } else {
      logout.style.display = 'none';
    }
  }
  function init(){
    var logout = qs('mh-logout');
    if (logout && window.AuthBridge) {
      logout.addEventListener('click', function(){
        try { sessionStorage.removeItem('postAuthRedirect'); } catch(_e){}
        var isInventory = false;
        try { isInventory = (location && /^\/inventory\//.test(location.pathname)) || (location && location.pathname === '/inventory/'); } catch(_e){}
        AuthBridge.signOut().then(function(){
          updateAuthUI(null);
          location.assign(isInventory ? '/inventory/' : '/');
        });
      });
      try { updateAuthUI(AuthBridge.currentUser && AuthBridge.currentUser()); } catch(_e){}
      try { AuthBridge.onChange && AuthBridge.onChange(updateAuthUI); } catch(_e){}
    } else {
      // Wait for AuthBridge readiness if not yet available
      window.addEventListener('auth:bridge-ready', init, { once: true });
    }
  }
  if (window.AuthBridge) init(); else window.addEventListener('auth:bridge-ready', init, { once: true });
})();
</script>
