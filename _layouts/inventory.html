---
layout: page
hide_sidebar: true
---
<div id="inventory-root">
  <div class="inventory-frame">
    <div id="inv-locked" style="display:none;" class="center-login">
      <h2 style="text-align:center;">Inventory</h2>
      <p style="text-align:center;">이 페이지는 로그인 후 이용할 수 있습니다.</p>
  <div class="card-glow inv-login-card" style="padding:1rem 1.25rem; border-radius:16px; max-width:420px; margin:0 auto;">
      <form id="inv-login" onsubmit="return false;" class="auth-form">
        <label>이메일
          <input name="email" type="email" required placeholder="name@example.com" style="width:100%; padding:.5rem .6rem;">
        </label>
        <label>비밀번호
          <input id="inv-password" name="password" type="password" required minlength="8" placeholder="비밀번호(특수문자 1개 이상 포함 권장)" style="width:100%; padding:.5rem .6rem;">
          <small style="display:block; margin-top:.25rem;">
            <label style="user-select:none; cursor:pointer;"><input id="inv-showpwd" type="checkbox" style="vertical-align:middle;"> <span style="vertical-align:middle;">비밀번호 표시</span></label>
          </small>
        </label>
        <div class="btn-row-center" style="display:flex; gap:.5rem; flex-wrap:wrap; justify-content:center;">
          <button class="btn" id="inv-email-signin"><span class="spinner" aria-hidden="true"></span><span class="btn-text">로그인</span></button>
          <button class="btn btn--alt-gradient" id="inv-email-signup"><span class="spinner" aria-hidden="true"></span><span class="btn-text">가입</span></button>
          <a class="btn btn--outline" href="/password-reset/">비밀번호 재설정</a>
        </div>
      </form>
      <div class="or">또는</div>
      <div class="oauth-stack oauth-center">
        <a href="#" id="inv-google" class="oauth-btn" aria-label="Sign in with Google" role="button">
          <img src="/assets/images/auth/google-signin.svg" alt="Sign in with Google">
        </a>
        <a href="#" id="inv-apple" class="oauth-btn" aria-label="Sign in with Apple" role="button">
          <img src="/assets/images/auth/apple-signin.svg" alt="Sign in with Apple">
        </a>
        <a href="#" id="inv-ms" class="oauth-btn" aria-label="Sign in with Microsoft" role="button">
          <img src="/assets/images/auth/microsoft-signin.svg" alt="Sign in with Microsoft">
        </a>
      </div>
      <div id="inv-error" class="auth-error" style="display:none;"></div>
      <div id="inv-appcheck-hint" style="display:none; margin-top:.5rem; font-size:.9rem; color:#92400e; background:#fffbeb; border:1px solid #fde68a; padding:.5rem .75rem; border-radius:8px;">
        reCAPTCHA(App Check) 검증에 실패했습니다. 브라우저 확장(광고/추적 차단)을 잠시 비활성화하거나 시크릿 창에서 시도해 주세요. 문제가 지속되면 관리자에게 문의해 주세요.
      </div>
      <div id="inv-unauth-hint" class="admin-hint" style="display:none; margin-top:.75rem;">
        <strong>이 도메인이 Firebase에 등록되지 않았습니다.</strong>
        <p style="margin:.25rem 0 .5rem;">관리자 안내: 아래 도메인을 Firebase Console → Authentication → Settings → Authorized domains에 추가해 주세요.</p>
        <div style="display:flex; gap:.5rem; align-items:center; flex-wrap:wrap;">
          <code id="inv-current-domain" style="padding:.15rem .4rem; border:1px solid rgba(0,0,0,.08); border-radius:6px; background:#fafafa;"></code>
          <button class="btn btn--outline" id="inv-copy-domain" type="button">도메인 복사</button>
          <a id="inv-open-fb-console" class="btn" target="_blank" rel="noopener">Firebase 콘솔 열기</a>
          <button class="btn btn--alt-gradient" id="inv-retry" type="button">새로고침 후 다시 시도</button>
        </div>
      </div>
      </div>
    </div>

    <div id="inv-unverified" style="display:none;" class="card-glow" aria-live="polite" style="padding:1rem 1.25rem; border-radius:16px; max-width:640px; margin:.75rem auto;">
      <strong>이메일 인증이 필요합니다.</strong>
      <p style="margin:.35rem 0 .75rem;">가입 시 발송된 인증 메일의 링크를 클릭한 후, 다시 접속해 주세요. 메일을 받지 못했다면 아래 버튼으로 재전송할 수 있습니다.</p>
      <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
        <button id="inv-resend-verify" class="btn"><span class="spinner" aria-hidden="true"></span><span class="btn-text">인증 메일 다시 보내기</span></button>
        <button id="inv-verify-refresh" class="btn btn--outline">인증 완료 후 새로고침</button>
        <a href="/account/" class="btn btn--outline">계정 관리로 이동</a>
      </div>
      <div id="inv-verify-msg" style="display:none; margin-top:.5rem; background:#ecfdf5; border:1px solid #a7f3d0; color:#065f46; padding:.5rem .75rem; border-radius:8px;"></div>
    </div>

    <div id="inv-unlocked" style="display:none;">
    <nav class="subnav" aria-label="Inventory navigation">
      <a class="subnav__link" data-path="/inventory/intro/" href="/inventory/intro/">어플리케이션 소개</a>
      <a class="subnav__link" data-path="/inventory/manual/" href="/inventory/manual/">사용자 매뉴얼</a>
      <a class="subnav__link" data-path="/inventory/faq/" href="/inventory/faq/">FAQ</a>
      <a class="subnav__link" data-path="/inventory/suggest/" href="/inventory/suggest/">건의하기</a>
      <a class="subnav__link" data-path="/inventory/bug-report/" href="/inventory/bug-report/">버그 리포팅</a>
      <span class="subnav__spacer"></span>
      <a class="subnav__home" href="/">Home</a>
      <button id="inv-logout" class="btn" type="button" style="margin-left:.5rem;">로그아웃</button>
    </nav>
      <div class="subcontent">
        {{ content }}
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  var locked = document.getElementById('inv-locked');
  var unlocked = document.getElementById('inv-unlocked');
  var loginForm = document.getElementById('inv-login');
  var btnEmail = document.getElementById('inv-email-signin');
  var btnSignup = document.getElementById('inv-email-signup');
  var btnG = document.getElementById('inv-google');
  var btnA = document.getElementById('inv-apple');
  var btnM = document.getElementById('inv-ms');
  var errBox = document.getElementById('inv-error');
  var unverified = document.getElementById('inv-unverified');
  var btnResend = document.getElementById('inv-resend-verify');
  var btnVerifyRefresh = document.getElementById('inv-verify-refresh');
  var verifyMsg = document.getElementById('inv-verify-msg');
  var unauthBox = document.getElementById('inv-unauth-hint');
  var domainEl = document.getElementById('inv-current-domain');
  var copyBtn = document.getElementById('inv-copy-domain');
  var retryBtn = document.getElementById('inv-retry');
  var fbConsoleLink = document.getElementById('inv-open-fb-console');
  var btnInvLogout = document.getElementById('inv-logout');
  var POST_AUTH_REDIRECT_KEY = 'postAuthRedirect';
  // highlight active link
  try {
    var here = location.pathname.replace(/\/?$/, '/');
    Array.prototype.forEach.call(document.querySelectorAll('.subnav__link'), function(a){
      if (a.getAttribute('data-path') === here) a.classList.add('is-active');
    });
  } catch(_e){}

  function show(section){ section.style.display=''; }
  function hide(section){ section.style.display='none'; }
  // Prepare admin hint content
  try {
    var CURRENT_HOST = (location && location.host) ? location.host : '';
    var FB_PROJECT = "{{ site.firebase.config.projectId | default: '' }}";
    var FB_CONSOLE_URL = FB_PROJECT ? ('https://console.firebase.google.com/project/' + FB_PROJECT + '/authentication/settings') : 'https://console.firebase.google.com/';
    if (domainEl) domainEl.textContent = CURRENT_HOST;
    if (fbConsoleLink) fbConsoleLink.href = FB_CONSOLE_URL;
    if (copyBtn) copyBtn.addEventListener('click', function(){
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(CURRENT_HOST).then(function(){ copyBtn.textContent = '복사됨'; setTimeout(function(){ copyBtn.textContent = '도메인 복사'; }, 1500); });
      } else {
        var tmp = document.createElement('input'); tmp.value = CURRENT_HOST; document.body.appendChild(tmp); tmp.select(); document.execCommand('copy'); document.body.removeChild(tmp);
        copyBtn.textContent = '복사됨'; setTimeout(function(){ copyBtn.textContent = '도메인 복사'; }, 1500);
      }
    });
    if (retryBtn) retryBtn.addEventListener('click', function(){ location.reload(); });
  } catch(_e){}

  function showError(e){
    if(!errBox) return;
    var code = e && e.code || '';
    var msg = (code ? ('['+code+'] ') : '') + (mapError(e));
    errBox.style.display='block';
    errBox.textContent = msg;
    if (code === 'auth/unauthorized-domain' && unauthBox) unauthBox.style.display = 'block';
  }
  function clearError(){ if(errBox){ errBox.style.display='none'; errBox.textContent=''; } }
  function mapError(e){
    var code = e && e.code || '';
    // Extract deep server message if present
    var srv = '';
    try {
      srv = (e && e.customData && e.customData._serverResponse && e.customData._serverResponse.error && e.customData._serverResponse.error.message) || '';
    } catch(_e){}
    var upper = String(srv || '').toUpperCase();
    // Network hints
    if (code === 'auth/network-request-failed' || /FAILED TO FETCH|NETWORK/i.test(String(e && e.message || ''))) {
      return '네트워크 오류로 로그인 요청이 실패했습니다. 광고/추적 차단기, 방화벽/VPN 설정을 확인하거나 다른 브라우저에서 시도해 주세요.';
    }
    // Server-side credential issues
    if (upper.indexOf('INVALID_PASSWORD') >= 0 || upper.indexOf('INVALID_LOGIN_CREDENTIALS') >= 0) {
      return '이메일 또는 비밀번호가 일치하지 않습니다. 대소문자/한영 전환을 확인하거나 비밀번호 재설정을 이용해 주세요.';
    }
    if (upper.indexOf('EMAIL_NOT_FOUND') >= 0) {
      return '등록되지 않은 이메일입니다. 먼저 가입을 진행해 주세요.';
    }
    if (upper.indexOf('USER_DISABLED') >= 0) {
      return '해당 계정은 비활성화되어 있습니다. 관리자에게 문의해 주세요.';
    }
    switch(code){
      case 'auth/unauthorized-domain': return '현재 사이트 도메인이 Firebase에 등록되지 않았습니다. 관리자에게 문의해 주세요.';
      case 'auth/invalid-credential': return '세션이 만료되었거나 인증 정보가 올바르지 않습니다. 새로고침 후 다시 시도해 주세요.';
      case 'auth/cancelled-popup-request': return '다른 인증 동작이 진행 중입니다. 잠시 후 다시 시도해 주세요.';
      case 'auth/operation-in-progress': return '인증을 시작하는 중입니다. 잠시만 기다려 주세요.';
      default: return (e && e.message) ? e.message : '로그인 중 오류가 발생했습니다.';
    }
  }
  function setLoading(btn, on){ if(!btn) return; btn.classList.toggle('loading', !!on); btn.disabled = !!on; }
  function toHereAfterAuth(){ try { sessionStorage.setItem(POST_AUTH_REDIRECT_KEY, location.pathname); } catch(_e){} }

  function guard(){ if(!window.AuthBridge){ showError({message:'인증 모듈이 초기화되지 않았습니다.'}); return false; } return true; }
  function isVerified(u){ return !!(u && (u.emailVerified || (u.providerData && u.providerData.some(function(p){ return p.providerId !== 'password'; })))); }
  function showVerified(){ hide(locked); if(unverified) hide(unverified); show(unlocked); }
  function showUnverified(){ hide(locked); if(unverified) show(unverified); hide(unlocked); }
  function update(user){
    if (user) { if (isVerified(user)) showVerified(); else showUnverified(); }
    else { show(locked); if(unverified) hide(unverified); hide(unlocked); }
  }

  function initGate(){
    try { var u = (AuthBridge && AuthBridge.currentUser && AuthBridge.currentUser()) || null; update(u); } catch(_e){}
    AuthBridge && AuthBridge.onChange && AuthBridge.onChange(update);
    if (AuthBridge && AuthBridge.getRedirectResult) {
      AuthBridge.getRedirectResult().then(function(res){
        var user = (res && res.user) || (AuthBridge.currentUser && AuthBridge.currentUser());
        if (user) {
          update(user);
          // If just signed-in and already verified, honor stored redirect
          try {
            if (isVerified(user)) {
              var dest = sessionStorage.getItem(POST_AUTH_REDIRECT_KEY);
              if (dest) { sessionStorage.removeItem(POST_AUTH_REDIRECT_KEY); location.assign(dest); return; }
            }
          } catch(_e){}
        }
      }).catch(function(e){
        // Handle common benign or recoverable redirect errors
        var benign = (e && (e.code === 'auth/no-auth-event' || e.code === 'auth/user-cancelled'));
        if (e && e.code === 'auth/invalid-credential') {
          try {
            for (var i = sessionStorage.length - 1; i >= 0; i--) {
              var k = sessionStorage.key(i);
              if (k && k.indexOf('firebase:') === 0) sessionStorage.removeItem(k);
            }
          } catch(_e){}
          try { AuthBridge.signOut && AuthBridge.signOut(); } catch(_e){}
          showError({ code: 'auth/invalid-credential', message: '세션이 만료되어 로그인에 실패했습니다. 다시 시도해 주세요.' });
          return;
        }
        // Surface App Check issues hint if recaptcha fails are observed upstream
        try { if (window.__appCheckActivated && errBox && (String(window.__fbInitError||'').indexOf('AppCheck')>=0)) { document.getElementById('inv-appcheck-hint').style.display='block'; } } catch(_e){}
        if (!benign) showError(e);
      });
    }
    // If initialization already recorded an App Check error, show hint immediately
    try {
      if (document.getElementById('inv-appcheck-hint') && String(window.__fbInitError||'').toLowerCase().indexOf('appcheck') >= 0) {
        document.getElementById('inv-appcheck-hint').style.display='block';
      }
    } catch(_e){}
  }
  if (window.AuthBridge) { initGate(); }
  else { window.addEventListener('auth:bridge-ready', initGate, { once: true }); }

  // email login
  if (btnEmail) btnEmail.addEventListener('click', function(){
    if(!guard()) return; if(!loginForm.reportValidity()) return;
    clearError(); setLoading(btnEmail, true); toHereAfterAuth();
    var email = loginForm.email.value.trim();
    AuthBridge.emailSignIn(email, loginForm.password.value).then(function(){
      // After sign-in, gate will decide (verified/unverified)
      var u = AuthBridge.currentUser && AuthBridge.currentUser();
      if (u && isVerified(u)) {
        var dest = sessionStorage.getItem(POST_AUTH_REDIRECT_KEY) || '/inventory/';
        try { sessionStorage.removeItem(POST_AUTH_REDIRECT_KEY); } catch(_e){}
        location.assign(dest);
      } else {
        update(u);
      }
    }).catch(showError).finally(function(){ setLoading(btnEmail, false); });
  });

  // email sign-up with basic policy hint and verification
  if (btnSignup) btnSignup.addEventListener('click', function(){
    if(!guard()) return; if(!loginForm.reportValidity()) return;
    clearError(); setLoading(btnSignup, true); toHereAfterAuth();
    var email = loginForm.email.value.trim();
    var pwd = loginForm.password.value || '';
    if (!/[^A-Za-z0-9]/.test(pwd)) { showError({ code:'auth/password-does-not-meet-requirements', message:'비밀번호에 특수문자 1개 이상을 포함해 주세요.' }); setLoading(btnSignup,false); return; }
    AuthBridge.emailSignUp(email, pwd).then(function(){
      // Send verification mail
      if (AuthBridge.sendEmailVerification) {
        return AuthBridge.sendEmailVerification().then(function(){
          if (verifyMsg) { verifyMsg.style.display='block'; verifyMsg.textContent='인증 메일을 '+ email +'로 보냈습니다. 메일함(스팸함 포함)을 확인해 주세요.'; }
          // Keep user signed-in but gate as unverified until they verify
          var u = AuthBridge.currentUser && AuthBridge.currentUser();
          update(u);
        });
      }
    }).catch(showError).finally(function(){ setLoading(btnSignup, false); });
  });

  // OAuth
  function oauth(name){ if(!guard()) return; clearError(); toHereAfterAuth(); AuthBridge.signInWith(name).catch(showError); }
  // resend verification
  if (btnResend) btnResend.addEventListener('click', function(){
    if(!guard()) return; clearError(); setLoading(btnResend, true);
    AuthBridge.sendEmailVerification().then(function(){ if (verifyMsg) { verifyMsg.style.display='block'; verifyMsg.textContent='인증 메일을 다시 보냈습니다.'; } }).catch(showError).finally(function(){ setLoading(btnResend,false); });
  });
  if (btnVerifyRefresh) btnVerifyRefresh.addEventListener('click', function(){ location.reload(); });
  if (btnG) btnG.addEventListener('click', function(e){ e.preventDefault(); oauth('google'); });
  if (btnA) btnA.addEventListener('click', function(e){ e.preventDefault(); oauth('apple'); });
  if (btnM) btnM.addEventListener('click', function(e){ e.preventDefault(); oauth('microsoft'); });
  // show password toggle
  try {
    var showPwd = document.getElementById('inv-showpwd');
    var pwdInput = document.getElementById('inv-password');
    if (showPwd && pwdInput) {
      showPwd.addEventListener('change', function(){ pwdInput.type = showPwd.checked ? 'text' : 'password'; });
    }
  } catch(_e){}

  // Global safety net: surface any unhandled auth errors to the UI (prevents silent flicker)
  try {
    window.addEventListener('unhandledrejection', function(ev){
      var r = ev && ev.reason;
      var msg = (r && (r.code || r.message)) ? (String(r.code) + ' ' + String(r.message)) : String(r || '');
      // Only surface auth-related issues
      if (/auth\//i.test(msg) || /signInWithPassword|INVALID_PASSWORD|EMAIL_NOT_FOUND|INVALID_LOGIN_CREDENTIALS/i.test(msg)){
        ev.preventDefault && ev.preventDefault();
        showError(r || { message: '로그인 중 오류가 발생했습니다.' });
      }
    });
  } catch(_e){}
  if (btnInvLogout) btnInvLogout.addEventListener('click', function(){
    if (!window.AuthBridge) return;
    try { sessionStorage.removeItem(POST_AUTH_REDIRECT_KEY); } catch(_e){}
    AuthBridge.signOut().then(function(){ location.assign('/'); });
  });

  // Optional inline debug banner (hidden by default)
  try {
    var dbg = document.createElement('div');
    dbg.style.cssText = 'position:sticky;top:0;z-index:2;margin:.5rem 0;padding:.35rem .5rem;border:1px dashed rgba(0,0,0,.15);border-radius:6px;font-size:.8rem;color:#334155;background:#f1f5f9;display:none;';
    dbg.id = 'inv-debug';
    var flags = [
      'fbInit=' + (window.__fbInit===true),
      'appCheck=' + (window.__appCheckActivated===true),
      'persistence=' + (window.__fbPersistence||'LOCAL'),
      'skip=' + (window.__fbInitSkippedReason||'')
    ].join(' | ');
    dbg.textContent = 'Auth debug: ' + flags;
    // Enable banner when query has ?debug=1
    if (location.search.indexOf('debug=1') !== -1) {
      var frame = document.querySelector('.inventory-frame');
      if (frame) { frame.insertBefore(dbg, frame.firstChild); dbg.style.display='block'; }
    }
  } catch(_e){}
})();
</script>

<style>
.inventory-frame{ border:2px solid #7c3aed; border-radius:18px; padding:1rem; max-width:1024px; margin: 0 auto; }
.center-login{ display:flex; flex-direction:column; gap:.5rem; align-items:center; }
.inv-login-card{ text-align:center; }
.inv-login-card .auth-form{ text-align:center; }
.inv-login-card .auth-form label{ display:block; text-align:center; }
.inv-login-card .auth-form input[type="email"],
.inv-login-card .auth-form input[type="password"]{ width:100%; }
.oauth-center{ align-items:center; }
.subnav{ display:flex; gap:.5rem; flex-wrap:wrap; align-items:center; padding:.5rem 0 1rem; border-bottom:1px solid rgba(0,0,0,.08); }
.subnav__link{ padding:.4rem .75rem; border-radius:999px; background:rgba(0,0,0,.04); border:1px solid rgba(0,0,0,.06); text-decoration:none; }
.subnav__link.is-active{ background:linear-gradient(90deg, #7c3aed, #06b6d4); color:#fff; border-color:transparent; }
.subnav__home{ margin-left:auto; padding:.35rem .6rem; color:rgba(0,0,0,.7); text-decoration:none; }
.subnav__spacer{ flex:1 1 auto; }
.subcontent{ padding-top:1rem; }
.auth-error{ margin-top: .75rem; background:#fff5f5; border:1px solid #ffd6d6; color:#be123c; padding:.75rem 1rem; border-radius:8px; }
.spinner{ display:none; width:1em; height:1em; border:.15em solid rgba(255,255,255,.6); border-top-color:#fff; border-radius:50%; animation:spin 1s linear infinite; margin-right:.4em; vertical-align:-.125em; }
.btn.loading .spinner{ display:inline-block; }
.btn.loading .btn-text{ opacity:.85; }
@keyframes spin{ to{ transform: rotate(360deg); } }
</style>
