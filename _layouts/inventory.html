---
layout: page
hide_sidebar: true
---
<div id="inventory-root">
  <div class="inventory-frame">
    <!-- Navigation (always visible) -->
    <nav style="display:flex; gap:.5rem; padding:.5rem 0 1rem; border-bottom:1px solid #e5e7eb; flex-wrap:wrap; align-items:center;">
      <a href="/inventory/" class="nav-link">í™ˆ</a>
      <a href="/inventory/changelog/" class="nav-link">ë²„ì „ ë¡œê·¸</a>
      <a href="/inventory/manual/" class="nav-link">ë§¤ë‰´ì–¼</a>
      <a href="/inventory/faq/" class="nav-link">ìì£¼í•˜ëŠ” ì§ˆë¬¸</a>
      <a href="/inventory/suggest/" class="nav-link">ê±´ì˜í•˜ê¸°</a>
      <a href="/inventory/bug-report/" class="nav-link">ë²„ê·¸ ë¦¬í¬íŠ¸</a>
      <span style="flex:1"></span>
      <!-- ì•± ëª¨ë“œì¼ ë•Œë§Œ í‘œì‹œ -->
      <span id="inv-user-email" style="display:none; font-size:.85rem; color:#6b7280; padding:.35rem .6rem;"></span>
    </nav>

    <!-- Content (always visible) -->
    <div style="padding-top:1rem;">
      {{ content }}
    </div>
  </div>
</div>

<script>
(function(){
  var APP_AUTH_KEY = 'inv_app_auth'; // ì•±ì—ì„œ ì „ë‹¬ë°›ì€ ì¸ì¦ ì •ë³´ í‚¤
  var userEmailEl = document.getElementById('inv-user-email');

  // ğŸ†• ì•±ì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°›ëŠ” ê¸€ë¡œë²Œ í•¨ìˆ˜
  window.setAppAuth = function(authData){
    try {
      console.log('[Inventory] ì•±ìœ¼ë¡œë¶€í„° ì¸ì¦ ì •ë³´ ìˆ˜ì‹ :', authData);

      if (!authData || !authData.email) {
        console.warn('[Inventory] ìœ íš¨í•˜ì§€ ì•Šì€ ì¸ì¦ ì •ë³´');
        return;
      }

      // ì´ë©”ì¼ ê²€ì¦ (ê¸°ë³¸ì ì¸ í˜•ì‹ ì²´í¬)
      var emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailPattern.test(authData.email)) {
        console.warn('[Inventory] ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹:', authData.email);
        return;
      }

      // sessionStorageì— ì €ì¥ (ìƒˆë¡œê³ ì¹¨ ì‹œì—ë„ ìœ ì§€)
      var userData = {
        email: authData.email,
        uid: authData.uid || 'app-user',
        displayName: authData.displayName || authData.name || null,
        timestamp: Date.now()
      };

      sessionStorage.setItem(APP_AUTH_KEY, JSON.stringify(userData));
      console.log('[Inventory] ì‚¬ìš©ì ì •ë³´ ì €ì¥ ì™„ë£Œ');

      // UI ì—…ë°ì´íŠ¸
      updateUI(userData);

      // ì „ì—­ ì´ë²¤íŠ¸ ë°œìƒ (í¼ í˜ì´ì§€ì—ì„œ ë¦¬ìŠ¤ë‹)
      window.dispatchEvent(new CustomEvent('app:auth-ready', {
        detail: userData
      }));

    } catch(e) {
      console.error('[Inventory] ì•± ì¸ì¦ ì •ë³´ ì²˜ë¦¬ ì‹¤íŒ¨:', e);
    }
  };

  // ğŸ†• ì €ì¥ëœ ì•± ì¸ì¦ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
  function loadAppAuth(){
    try {
      var stored = sessionStorage.getItem(APP_AUTH_KEY);
      if (!stored) return null;

      var userData = JSON.parse(stored);

      // íƒ€ì„ìŠ¤íƒ¬í”„ í™•ì¸ (24ì‹œê°„ ì´ë‚´ë§Œ ìœ íš¨)
      if (userData.timestamp && (Date.now() - userData.timestamp > 24 * 60 * 60 * 1000)) {
        console.log('[Inventory] ì¸ì¦ ì •ë³´ ë§Œë£Œë¨');
        sessionStorage.removeItem(APP_AUTH_KEY);
        return null;
      }

      console.log('[Inventory] ì €ì¥ëœ ì¸ì¦ ì •ë³´ ë³µì›:', userData.email);
      return userData;

    } catch(e) {
      console.warn('[Inventory] ì¸ì¦ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', e);
      sessionStorage.removeItem(APP_AUTH_KEY);
      return null;
    }
  }

  // ğŸ†• UI ì—…ë°ì´íŠ¸
  function updateUI(userData){
    if (!userData || !userData.email) return;

    // ì´ë©”ì¼ í‘œì‹œ
    if (userEmailEl) {
      userEmailEl.textContent = userData.email;
      userEmailEl.style.display = 'block';
    }
  }

  // ğŸ†• ì•± ì¸ì¦ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (í¼ í˜ì´ì§€ì—ì„œ ì‚¬ìš©)
  window.getAppAuth = function(){
    return loadAppAuth();
  };

  // ğŸ†• ì•± ì¸ì¦ ì •ë³´ ì´ˆê¸°í™” (ë¡œê·¸ì•„ì›ƒ ë“±)
  window.clearAppAuth = function(){
    try {
      sessionStorage.removeItem(APP_AUTH_KEY);
      if (userEmailEl) {
        userEmailEl.style.display = 'none';
        userEmailEl.textContent = '';
      }
      console.log('[Inventory] ì¸ì¦ ì •ë³´ ì‚­ì œë¨');
    } catch(e) {
      console.error('[Inventory] ì¸ì¦ ì •ë³´ ì‚­ì œ ì‹¤íŒ¨:', e);
    }
  };

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ì¸ì¦ ì •ë³´ í™•ì¸
  var savedAuth = loadAppAuth();
  if (savedAuth) {
    console.log('[Inventory] í˜ì´ì§€ ë¡œë“œ: ê¸°ì¡´ ì¸ì¦ ì •ë³´ ì‚¬ìš©');
    updateUI(savedAuth);

    // ì´ë¯¸ ì¸ì¦ ì •ë³´ê°€ ìˆìœ¼ë©´ ì¦‰ì‹œ ì´ë²¤íŠ¸ ë°œìƒ
    setTimeout(function(){
      window.dispatchEvent(new CustomEvent('app:auth-ready', {
        detail: savedAuth
      }));
    }, 100);
  }

})();
</script>

<style>
.inventory-frame{
  max-width: 960px;
  margin: 0 auto;
  padding: 1rem;
}
.nav-link{
  padding: .4rem .75rem;
  border-radius: 6px;
  background: #f3f4f6;
  text-decoration: none;
  color: #374151;
}
.nav-link:hover{
  background: #e5e7eb;
}
/* ì•ˆì „ë§: ì¢Œì¸¡ ìƒë‹¨(masthead)ì˜ ë¡œê·¸ì•„ì›ƒë§Œ ìˆ¨ê¹€ ì²˜ë¦¬ */
#mh-logout { display: none !important; }
</style>
