---
layout: page
hide_sidebar: true
---
<div id="inventory-root">
  <div class="inventory-frame">
    <div id="inv-locked" style="display:none;" class="center-login">
      <h2 style="text-align:center;">Inventory</h2>
      <p style="text-align:center;">이 페이지는 로그인 후 이용할 수 있습니다.</p>
      <div class="card-glow" style="padding:1rem 1.25rem; border-radius:16px; max-width:420px; margin:0 auto;">
      <form id="inv-login" onsubmit="return false;" class="auth-form">
        <label>이메일
          <input name="email" type="email" required placeholder="name@example.com" style="width:100%; padding:.5rem .6rem;">
        </label>
        <label>비밀번호
          <input name="password" type="password" required minlength="8" placeholder="비밀번호(특수문자 1개 이상 포함 권장)" style="width:100%; padding:.5rem .6rem;">
        </label>
        <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
          <button class="btn" id="inv-email-signin"><span class="spinner" aria-hidden="true"></span><span class="btn-text">로그인</span></button>
          <button class="btn btn--alt-gradient" id="inv-email-signup"><span class="spinner" aria-hidden="true"></span><span class="btn-text">가입</span></button>
          <a class="btn btn--outline" href="/password-reset/">비밀번호 재설정</a>
        </div>
      </form>
      <div class="or">또는</div>
      <div class="oauth-stack">
        <a href="#" id="inv-google" class="oauth-btn" aria-label="Sign in with Google" role="button">
          <img src="/assets/images/auth/google-signin.svg" alt="Sign in with Google">
        </a>
        <a href="#" id="inv-apple" class="oauth-btn" aria-label="Sign in with Apple" role="button">
          <img src="/assets/images/auth/apple-signin.svg" alt="Sign in with Apple">
        </a>
        <a href="#" id="inv-ms" class="oauth-btn" aria-label="Sign in with Microsoft" role="button">
          <img src="/assets/images/auth/microsoft-signin.svg" alt="Sign in with Microsoft">
        </a>
      </div>
      <div id="inv-error" class="auth-error" style="display:none;"></div>
      </div>
    </div>

    <div id="inv-unverified" style="display:none;" class="card-glow" aria-live="polite" style="padding:1rem 1.25rem; border-radius:16px; max-width:640px; margin:.75rem auto;">
      <strong>이메일 인증이 필요합니다.</strong>
      <p style="margin:.35rem 0 .75rem;">가입 시 발송된 인증 메일의 링크를 클릭한 후, 다시 접속해 주세요. 메일을 받지 못했다면 아래 버튼으로 재전송할 수 있습니다.</p>
      <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
        <button id="inv-resend-verify" class="btn"><span class="spinner" aria-hidden="true"></span><span class="btn-text">인증 메일 다시 보내기</span></button>
        <button id="inv-verify-refresh" class="btn btn--outline">인증 완료 후 새로고침</button>
        <a href="/account/" class="btn btn--outline">계정 관리로 이동</a>
      </div>
      <div id="inv-verify-msg" style="display:none; margin-top:.5rem; background:#ecfdf5; border:1px solid #a7f3d0; color:#065f46; padding:.5rem .75rem; border-radius:8px;"></div>
    </div>

    <div id="inv-unlocked" style="display:none;">
    <nav class="subnav" aria-label="Inventory navigation">
      <a class="subnav__link" data-path="/inventory/intro/" href="/inventory/intro/">어플리케이션 소개</a>
      <a class="subnav__link" data-path="/inventory/manual/" href="/inventory/manual/">사용자 매뉴얼</a>
      <a class="subnav__link" data-path="/inventory/faq/" href="/inventory/faq/">FAQ</a>
      <a class="subnav__link" data-path="/inventory/suggest/" href="/inventory/suggest/">건의하기</a>
      <a class="subnav__link" data-path="/inventory/bug-report/" href="/inventory/bug-report/">버그 리포팅</a>
      <span class="subnav__spacer"></span>
      <a class="subnav__home" href="/">Home</a>
    </nav>
      <div class="subcontent">
        {{ content }}
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  var locked = document.getElementById('inv-locked');
  var unlocked = document.getElementById('inv-unlocked');
  var loginForm = document.getElementById('inv-login');
  var btnEmail = document.getElementById('inv-email-signin');
  var btnSignup = document.getElementById('inv-email-signup');
  var btnG = document.getElementById('inv-google');
  var btnA = document.getElementById('inv-apple');
  var btnM = document.getElementById('inv-ms');
  var errBox = document.getElementById('inv-error');
  var unverified = document.getElementById('inv-unverified');
  var btnResend = document.getElementById('inv-resend-verify');
  var btnVerifyRefresh = document.getElementById('inv-verify-refresh');
  var verifyMsg = document.getElementById('inv-verify-msg');
  var POST_AUTH_REDIRECT_KEY = 'postAuthRedirect';
  // highlight active link
  try {
    var here = location.pathname.replace(/\/?$/, '/');
    Array.prototype.forEach.call(document.querySelectorAll('.subnav__link'), function(a){
      if (a.getAttribute('data-path') === here) a.classList.add('is-active');
    });
  } catch(_e){}

  function show(section){ section.style.display=''; }
  function hide(section){ section.style.display='none'; }
  function showError(e){
    if(!errBox) return;
    var msg = (e && e.code) ? ('['+e.code+'] ') : '';
    msg += (e && e.message) ? e.message : '로그인 중 오류가 발생했습니다.';
    errBox.style.display='block';
    errBox.textContent = msg;
  }
  function clearError(){ if(errBox){ errBox.style.display='none'; errBox.textContent=''; } }
  function setLoading(btn, on){ if(!btn) return; btn.classList.toggle('loading', !!on); btn.disabled = !!on; }
  function toHereAfterAuth(){ try { sessionStorage.setItem(POST_AUTH_REDIRECT_KEY, location.pathname); } catch(_e){} }

  function guard(){ if(!window.AuthBridge){ showError({message:'인증 모듈이 초기화되지 않았습니다.'}); return false; } return true; }
  function isVerified(u){ return !!(u && (u.emailVerified || (u.providerData && u.providerData.some(function(p){ return p.providerId !== 'password'; })))); }
  function showVerified(){ hide(locked); if(unverified) hide(unverified); show(unlocked); }
  function showUnverified(){ hide(locked); if(unverified) show(unverified); hide(unlocked); }
  function update(user){
    if (user) { if (isVerified(user)) showVerified(); else showUnverified(); }
    else { show(locked); if(unverified) hide(unverified); hide(unlocked); }
  }

  function initGate(){
    try { var u = (AuthBridge && AuthBridge.currentUser && AuthBridge.currentUser()) || null; update(u); } catch(_e){}
    AuthBridge && AuthBridge.onChange && AuthBridge.onChange(update);
    if (AuthBridge && AuthBridge.getRedirectResult) {
      AuthBridge.getRedirectResult().then(function(res){
        var user = (res && res.user) || (AuthBridge.currentUser && AuthBridge.currentUser());
        if (user) update(user);
      }).catch(function(_e){ /* ignore */ });
    }
  }
  if (window.AuthBridge) { initGate(); }
  else { window.addEventListener('auth:bridge-ready', initGate, { once: true }); }

  // email login
  if (btnEmail) btnEmail.addEventListener('click', function(){
    if(!guard()) return; if(!loginForm.reportValidity()) return;
    clearError(); setLoading(btnEmail, true); toHereAfterAuth();
    var email = loginForm.email.value.trim();
    AuthBridge.emailSignIn(email, loginForm.password.value).then(function(){
      // After sign-in, gate will decide (verified/unverified)
      var u = AuthBridge.currentUser && AuthBridge.currentUser();
      if (u && isVerified(u)) {
        var dest = sessionStorage.getItem(POST_AUTH_REDIRECT_KEY) || '/inventory/';
        try { sessionStorage.removeItem(POST_AUTH_REDIRECT_KEY); } catch(_e){}
        location.assign(dest);
      } else {
        update(u);
      }
    }).catch(showError).finally(function(){ setLoading(btnEmail, false); });
  });

  // email sign-up with basic policy hint and verification
  if (btnSignup) btnSignup.addEventListener('click', function(){
    if(!guard()) return; if(!loginForm.reportValidity()) return;
    clearError(); setLoading(btnSignup, true); toHereAfterAuth();
    var email = loginForm.email.value.trim();
    var pwd = loginForm.password.value || '';
    if (!/[^A-Za-z0-9]/.test(pwd)) { showError({ code:'auth/password-does-not-meet-requirements', message:'비밀번호에 특수문자 1개 이상을 포함해 주세요.' }); setLoading(btnSignup,false); return; }
    AuthBridge.emailSignUp(email, pwd).then(function(){
      // Send verification mail
      if (AuthBridge.sendEmailVerification) {
        return AuthBridge.sendEmailVerification().then(function(){
          if (verifyMsg) { verifyMsg.style.display='block'; verifyMsg.textContent='인증 메일을 '+ email +'로 보냈습니다. 메일함(스팸함 포함)을 확인해 주세요.'; }
          // Keep user signed-in but gate as unverified until they verify
          var u = AuthBridge.currentUser && AuthBridge.currentUser();
          update(u);
        });
      }
    }).catch(showError).finally(function(){ setLoading(btnSignup, false); });
  });

  // OAuth
  function oauth(name){ if(!guard()) return; clearError(); toHereAfterAuth(); AuthBridge.signInWith(name).catch(showError); }
  // resend verification
  if (btnResend) btnResend.addEventListener('click', function(){
    if(!guard()) return; clearError(); setLoading(btnResend, true);
    AuthBridge.sendEmailVerification().then(function(){ if (verifyMsg) { verifyMsg.style.display='block'; verifyMsg.textContent='인증 메일을 다시 보냈습니다.'; } }).catch(showError).finally(function(){ setLoading(btnResend,false); });
  });
  if (btnVerifyRefresh) btnVerifyRefresh.addEventListener('click', function(){ location.reload(); });
  if (btnG) btnG.addEventListener('click', function(e){ e.preventDefault(); oauth('google'); });
  if (btnA) btnA.addEventListener('click', function(e){ e.preventDefault(); oauth('apple'); });
  if (btnM) btnM.addEventListener('click', function(e){ e.preventDefault(); oauth('microsoft'); });
})();
</script>

<style>
.inventory-frame{ border:2px solid #7c3aed; border-radius:18px; padding:1rem; max-width:1024px; margin: 0 auto; }
.center-login{ display:flex; flex-direction:column; gap:.5rem; }
.subnav{ display:flex; gap:.5rem; flex-wrap:wrap; align-items:center; padding:.5rem 0 1rem; border-bottom:1px solid rgba(0,0,0,.08); }
.subnav__link{ padding:.4rem .75rem; border-radius:999px; background:rgba(0,0,0,.04); border:1px solid rgba(0,0,0,.06); text-decoration:none; }
.subnav__link.is-active{ background:linear-gradient(90deg, #7c3aed, #06b6d4); color:#fff; border-color:transparent; }
.subnav__home{ margin-left:auto; padding:.35rem .6rem; color:rgba(0,0,0,.7); text-decoration:none; }
.subnav__spacer{ flex:1 1 auto; }
.subcontent{ padding-top:1rem; }
.auth-error{ margin-top: .75rem; background:#fff5f5; border:1px solid #ffd6d6; color:#be123c; padding:.75rem 1rem; border-radius:8px; }
.spinner{ display:none; width:1em; height:1em; border:.15em solid rgba(255,255,255,.6); border-top-color:#fff; border-radius:50%; animation:spin 1s linear infinite; margin-right:.4em; vertical-align:-.125em; }
.btn.loading .spinner{ display:inline-block; }
.btn.loading .btn-text{ opacity:.85; }
@keyframes spin{ to{ transform: rotate(360deg); } }
</style>
