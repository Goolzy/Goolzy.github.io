{
  "rules": {
    "user_sessions": {
      "$userId": {
        ".read": "auth != null && auth.uid == $userId",
        ".write": "auth != null && auth.uid == $userId"
      }
    },
    "inline-chat": {
      "messages": {
        ".read": true,
        ".write": "auth != null && (
          root.child('inline-chat/messages').exists() === false ||
          auth.token.email.endsWith('@goolzy.com')
        )",
        ".indexOn": ["timestamp"],
        "$messageId": {
          ".write": "auth != null",
          ".validate": "newData.hasChildren(['email', 'text', 'timestamp'])",
          "email": {
            ".validate": "newData.isString() && newData.val().length > 0"
          },
          "text": {
            ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 500"
          },
          "timestamp": {
            ".validate": "newData.val() === now"
          }
        }
      },
      "connections": {
        ".read": true,
        "$connectionId": {
          ".write": "auth != null"
        }
      },
      "banned-users": {
        ".read": "auth != null",
        "$sanitizedEmail": {
          ".write": "auth != null && (
            auth.token.email.endsWith('@goolzy.com') ||
            (!newData.exists() && data.child('banUntil').val() < now)
          )",
          ".validate": "newData.hasChildren(['email', 'bannedBy', 'bannedAt', 'banUntil', 'duration'])",
          "email": {
            ".validate": "newData.isString() && newData.val().length > 0"
          },
          "bannedBy": {
            ".validate": "newData.isString() && newData.val().length > 0"
          },
          "bannedAt": {
            ".validate": "newData.val() === now"
          },
          "banUntil": {
            ".validate": "newData.isNumber() && newData.val() > now"
          },
          "duration": {
            ".validate": "newData.isNumber() && newData.val() > 0"
          }
        }
      }
    }
  }
}
